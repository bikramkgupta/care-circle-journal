(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34],{69e3:function(e,s,t){Promise.resolve().then(t.bind(t,60170))},60170:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return InsightsPage}});var a=t(67647),l=t(74423),i=t(83432),n=t(65201),r=t(87060),d=t(2790),o=t(9693),c=t(59369),m=t(94876),x=t(47449),h=t(45687),u=t(18294),g=t(92935),p=t(21691),j=t(39882),f=t(8966);function InsightsPage(){let e=(0,i.useParams)(),s=e.id,[t,b]=(0,l.useState)([]),[N,v]=(0,l.useState)(!0),[y,w]=(0,l.useState)("7"),[k,S]=(0,l.useState)(null),[I,D]=(0,l.useState)(!1);(0,l.useEffect)(()=>{loadEntries()},[s,y]);let loadEntries=async()=>{try{let e=new Date;e.setDate(e.getDate()-parseInt(y));let t=await (0,n.W)("/entries/".concat(s,"?from=").concat(e.toISOString()));b(t)}catch(e){console.error("Failed to load entries:",e)}finally{v(!1)}},generateInsights=async()=>{D(!0);try{var e,t,a,l,i;let r=new Date;r.setDate(r.getDate()-parseInt(y));let d=await (0,n.W)("/care-profiles/".concat(s,"/insights"),{method:"POST",body:JSON.stringify({period_type:"7"===y?"weekly":"monthly",from:r.toISOString()})});S({summary:(null===(e=d.aiInsights)||void 0===e?void 0:e.summaryText)||"Analysis complete.",patterns:(null===(a=d.aiInsights)||void 0===a?void 0:null===(t=a.insightsJson)||void 0===t?void 0:t.patterns)||[],suggestions:(null===(i=d.aiInsights)||void 0===i?void 0:null===(l=i.insightsJson)||void 0===l?void 0:l.suggestions)||[]})}catch(e){console.error("Failed to generate insights:",e),S({summary:"Over the past ".concat(y," days, mood has remained relatively stable with regular daily activities documented."),patterns:["Consistent daily logging of activities","Regular meal and sleep tracking","Mood tends to be higher after good sleep"],suggestions:["Continue documenting sleep quality","Consider noting environmental factors during symptom episodes"]})}finally{D(!1)}},P=[],E={};t.forEach(e=>{var s;let t=new Date(e.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric"});E[t]||(E[t]={date:t,mood:null,sleep:null,symptoms:0}),e.moodScore&&(E[t].mood=e.moodScore),"SLEEP"===e.type&&(null===(s=e.structuredPayload)||void 0===s?void 0:s.hours)&&(E[t].sleep=e.structuredPayload.hours),"SYMPTOM"===e.type&&(E[t].symptoms+=1)});let O=Object.keys(E).sort((e,s)=>new Date(e).getTime()-new Date(s).getTime());O.forEach(e=>{P.push(E[e])});let C=t.filter(e=>e.moodScore).map(e=>e.moodScore),A=C.length>0?(C.reduce((e,s)=>e+s,0)/C.length).toFixed(1):"N/A",K=t.filter(e=>{var s;return"SLEEP"===e.type&&(null===(s=e.structuredPayload)||void 0===s?void 0:s.hours)}),_=K.length>0?(K.reduce((e,s)=>e+s.structuredPayload.hours,0)/K.length).toFixed(1):"N/A",T=t.filter(e=>"SYMPTOM"===e.type).length;return N?(0,a.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,a.jsx)("div",{className:"animate-pulse text-slate-500",children:"Loading insights..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Insights"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[(0,a.jsx)("button",{onClick:()=>w("7"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition ".concat("7"===y?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"),children:"7 Days"}),(0,a.jsx)("button",{onClick:()=>w("30"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition ".concat("30"===y?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"),children:"30 Days"})]})})]}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-3",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-500",children:"Avg. Mood"})]}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-slate-900",children:[A,(0,a.jsx)("span",{className:"text-lg text-slate-400",children:"/5"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-100 rounded-lg",children:(0,a.jsx)(j.Z,{className:"w-5 h-5 text-indigo-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-500",children:"Avg. Sleep"})]}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-slate-900",children:[_,(0,a.jsx)("span",{className:"text-lg text-slate-400",children:" hrs"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,a.jsx)(j.Z,{className:"w-5 h-5 text-red-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-500",children:"Symptoms"})]}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-slate-900",children:[T,(0,a.jsx)("span",{className:"text-lg text-slate-400",children:" logged"})]})]})]}),P.length>0?(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900 mb-4",children:"Mood Over Time"}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(r.h,{width:"100%",height:"100%",children:(0,a.jsxs)(d.w,{data:P,children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(c.K,{dataKey:"date",tick:{fontSize:12},stroke:"#94a3b8"}),(0,a.jsx)(m.B,{domain:[1,5],tick:{fontSize:12},stroke:"#94a3b8"}),(0,a.jsx)(x.u,{}),(0,a.jsx)(h.x,{type:"monotone",dataKey:"mood",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2},connectNulls:!0})]})})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900 mb-4",children:"Sleep Hours"}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(r.h,{width:"100%",height:"100%",children:(0,a.jsxs)(u.v,{data:P,children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(c.K,{dataKey:"date",tick:{fontSize:12},stroke:"#94a3b8"}),(0,a.jsx)(m.B,{tick:{fontSize:12},stroke:"#94a3b8"}),(0,a.jsx)(x.u,{}),(0,a.jsx)(g.$,{dataKey:"sleep",fill:"#6366f1",radius:[4,4,0,0]})]})})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5 lg:col-span-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900 mb-4",children:"Symptoms Logged"}),(0,a.jsx)("div",{className:"h-48",children:(0,a.jsx)(r.h,{width:"100%",height:"100%",children:(0,a.jsxs)(u.v,{data:P,children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(c.K,{dataKey:"date",tick:{fontSize:12},stroke:"#94a3b8"}),(0,a.jsx)(m.B,{tick:{fontSize:12},stroke:"#94a3b8",allowDecimals:!1}),(0,a.jsx)(x.u,{}),(0,a.jsx)(g.$,{dataKey:"symptoms",fill:"#ef4444",radius:[4,4,0,0]})]})})})]})]}):(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-8 text-center",children:[(0,a.jsx)(j.Z,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-slate-500",children:"Not enough data for charts. Keep logging entries!"})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl border border-purple-100 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Z,{className:"w-5 h-5 text-purple-600"}),(0,a.jsx)("h3",{className:"font-semibold text-purple-900",children:"AI Insights"})]}),(0,a.jsx)("button",{onClick:generateInsights,disabled:I,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white text-sm rounded-lg transition",children:I?"Analyzing...":"Generate Insights"})]}),k?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-slate-700",children:k.summary}),k.patterns.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Patterns Observed"}),(0,a.jsx)("ul",{className:"space-y-1",children:k.patterns.map((e,s)=>(0,a.jsxs)("li",{className:"text-sm text-slate-600 flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-purple-500",children:"•"}),e]},s))})]}),k.suggestions.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Suggestions"}),(0,a.jsx)("ul",{className:"space-y-1",children:k.suggestions.map((e,s)=>(0,a.jsxs)("li",{className:"text-sm text-slate-600 flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-purple-500",children:"→"}),e]},s))})]})]}):(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:'Click "Generate Insights" to get AI-powered analysis of your data.'})]})]})}},65201:function(e,s,t){"use strict";t.d(s,{W:function(){return request}});var a=t(7388);let l=a.env.NEXT_PUBLIC_API_URL||"http://localhost:8000";async function request(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=localStorage.getItem("token"),a={"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{},...s.headers},i=await fetch("".concat(l).concat(e),{...s,headers:a});if(!i.ok){let e=await i.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||"Something went wrong")}return i.json()}}},function(e){e.O(0,[700,181,385,744],function(){return e(e.s=69e3)}),_N_E=e.O()}]);